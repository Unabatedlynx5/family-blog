---
import HeaderLink from './HeaderLink.astro';
import { SITE_TITLE } from '../consts';
---

<header class="m-0 px-4 bg-white shadow-[0_2px_8px_rgba(15,18,25,0.05)]">
	<nav class="flex items-center justify-between gap-4">
		<h2 class="m-0 text-base"><a href="/">{SITE_TITLE}</a></h2>
		<div class="internal-links flex gap-2 items-center flex-wrap md:flex-nowrap">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/feed">Feed</HeaderLink>
			<HeaderLink href="/chat">Chat</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
			<HeaderLink href="/settings">Settings</HeaderLink>
		</div>
		<div class="actions flex items-center">
			<a id="auth-link" href="/login" class="px-3 py-2 rounded-md bg-black/5 no-underline text-black">Sign in</a>
		</div>
	</nav>
</header>

<script>
// client-side: toggle auth link text based on stored access token
(function(){
  try{
    const a = document.getElementById('auth-link') as HTMLAnchorElement | null;
    const token = sessionStorage.getItem('accessToken');
    if(!a) return;
    if(token){
      a.textContent = 'Sign out';
      a.href = '#';
      a.addEventListener('click', async (e)=>{
        e.preventDefault();
        await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
        sessionStorage.removeItem('accessToken');
        window.location.href = '/login';
      });
    } else {
      a.textContent = 'Sign in';
      a.href = '/login';
    }
  }catch(e){}
})();
</script>
